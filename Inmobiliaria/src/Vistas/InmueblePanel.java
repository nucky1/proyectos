/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Vistas;

import Controllers.InmuebleController;
import Modelo.Inmueble;
import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.JOptionPane;
import javax.swing.SpinnerNumberModel;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Usuario1
 */
public class InmueblePanel extends javax.swing.JPanel implements InmuebleView {
    
    private TestVista tv;
    private HashMap<Integer,Inmueble> mapI =null;
    private final HashMap<Integer,String> tipoInmueble;
    private final HashMap<Integer,String> operacion;
    private final HashMap<Integer,String> estado;
    /**
     * Creates new form NewJPanel
     */
    public InmueblePanel() {
        initComponents();
        SpinnerNumberModel smHasta = new SpinnerNumberModel();
        smHasta.setStepSize(100);
        smHasta.setValue(20000);
        SpinnerNumberModel smDesde = new SpinnerNumberModel();
        smDesde.setStepSize(100);
        smDesde.setValue(0);
        spinDesde.setModel(smDesde);
        spinHasta.setModel(smHasta);
        this.botonDetalles.setEnabled(false);
        
        tipoInmueble = new HashMap<>();
        tipoInmueble.put(0,null);
        tipoInmueble.put(1,"Casa");
        tipoInmueble.put(2,"Departamento");
        tipoInmueble.put(3,"Local");
        tipoInmueble.put(4,"Terreno");
        operacion = new HashMap<>();
        operacion.put(0,null);
        operacion.put(1,"Vender");
        operacion.put(2,"Alquilar");
        operacion.put(3,"Ambos");
        estado = new HashMap<>();
        estado.put(0,null);
        estado.put(1,"Disponible");
        estado.put(2,"No Disponible");
        estado.put(3,"Reservado");
        estado.put(4,"Ocupado");
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jDialog1 = new javax.swing.JDialog();
        jDialog2 = new javax.swing.JDialog();
        jLabel4 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tablaInmueble = new javax.swing.JTable();
        jcbEstado = new javax.swing.JComboBox<>();
        jcbHabitaciones = new javax.swing.JComboBox<>();
        jcbOperacion = new javax.swing.JComboBox<>();
        jcbTipoInmueble = new javax.swing.JComboBox<>();
        botonListar = new javax.swing.JButton();
        spinDesde = new javax.swing.JSpinner();
        jLabel2 = new javax.swing.JLabel();
        spinHasta = new javax.swing.JSpinner();
        jLabel3 = new javax.swing.JLabel();
        botonAlquilar = new javax.swing.JButton();
        botonDetalles = new javax.swing.JButton();
        jcbZona = new javax.swing.JComboBox<>();

        jLabel4.setText("Soy un JDIALOG");

        jButton1.setText("jButton1");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jDialog2Layout = new javax.swing.GroupLayout(jDialog2.getContentPane());
        jDialog2.getContentPane().setLayout(jDialog2Layout);
        jDialog2Layout.setHorizontalGroup(
            jDialog2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jDialog2Layout.createSequentialGroup()
                .addGroup(jDialog2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jDialog2Layout.createSequentialGroup()
                        .addGap(164, 164, 164)
                        .addComponent(jLabel4))
                    .addGroup(jDialog2Layout.createSequentialGroup()
                        .addGap(127, 127, 127)
                        .addComponent(jButton1)))
                .addContainerGap(157, Short.MAX_VALUE))
        );
        jDialog2Layout.setVerticalGroup(
            jDialog2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jDialog2Layout.createSequentialGroup()
                .addGap(141, 141, 141)
                .addComponent(jLabel4)
                .addGap(18, 18, 18)
                .addComponent(jButton1)
                .addContainerGap(104, Short.MAX_VALUE))
        );

        setBackground(new java.awt.Color(255, 255, 255));
        setLayout(null);

        jLabel1.setFont(new java.awt.Font("Tahoma", 1, 22)); // NOI18N
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Recursos/CapturaInfo.PNG"))); // NOI18N
        jLabel1.setText("INVERSIONES MERCEDES ");
        jLabel1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(255, 100, 0), 2));
        add(jLabel1);
        jLabel1.setBounds(0, 0, 1260, 90);

        tablaInmueble.setBackground(new java.awt.Color(255, 204, 102));
        tablaInmueble.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));
        tablaInmueble.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "ID", "Direccion", "Zona", "Precio", "Tipo de Inmueble", "Operacion", "Estado", "Habitaciones"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tablaInmueble.setAutoscrolls(false);
        tablaInmueble.getTableHeader().setReorderingAllowed(false);
        jScrollPane1.setViewportView(tablaInmueble);
        if (tablaInmueble.getColumnModel().getColumnCount() > 0) {
            tablaInmueble.getColumnModel().getColumn(0).setMinWidth(50);
            tablaInmueble.getColumnModel().getColumn(0).setPreferredWidth(50);
            tablaInmueble.getColumnModel().getColumn(0).setMaxWidth(50);
            tablaInmueble.getColumnModel().getColumn(1).setMinWidth(250);
            tablaInmueble.getColumnModel().getColumn(1).setMaxWidth(250);
            tablaInmueble.getColumnModel().getColumn(2).setMinWidth(120);
            tablaInmueble.getColumnModel().getColumn(2).setPreferredWidth(120);
            tablaInmueble.getColumnModel().getColumn(4).setMinWidth(120);
            tablaInmueble.getColumnModel().getColumn(4).setPreferredWidth(120);
            tablaInmueble.getColumnModel().getColumn(5).setMinWidth(120);
            tablaInmueble.getColumnModel().getColumn(5).setPreferredWidth(120);
            tablaInmueble.getColumnModel().getColumn(6).setMinWidth(120);
            tablaInmueble.getColumnModel().getColumn(6).setPreferredWidth(120);
            tablaInmueble.getColumnModel().getColumn(7).setMinWidth(120);
            tablaInmueble.getColumnModel().getColumn(7).setPreferredWidth(120);
        }

        add(jScrollPane1);
        jScrollPane1.setBounds(20, 180, 1040, 380);

        jcbEstado.setBackground(new java.awt.Color(255, 200, 0));
        jcbEstado.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Estado", "Disponible", "No disponible", "Reservado", "Ocupado" }));
        add(jcbEstado);
        jcbEstado.setBounds(800, 110, 130, 40);

        jcbHabitaciones.setBackground(new java.awt.Color(255, 200, 0));
        jcbHabitaciones.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Habitaciones", "1 Habitacion", "2 Habitaciones", "3 Habitaciones", "4 Habitaciones", "5 o m√°s Hab." }));
        add(jcbHabitaciones);
        jcbHabitaciones.setBounds(940, 110, 120, 40);

        jcbOperacion.setBackground(new java.awt.Color(255, 200, 0));
        jcbOperacion.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Operacion", "Vender", "Alquilar", "Vender o Alquilar" }));
        jcbOperacion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcbOperacionActionPerformed(evt);
            }
        });
        add(jcbOperacion);
        jcbOperacion.setBounds(660, 110, 130, 40);

        jcbTipoInmueble.setBackground(new java.awt.Color(255, 200, 0));
        jcbTipoInmueble.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Tipo de Inmueble", "Casa", "Departamento", "Local", "Terreno" }));
        jcbTipoInmueble.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcbTipoInmuebleActionPerformed(evt);
            }
        });
        add(jcbTipoInmueble);
        jcbTipoInmueble.setBounds(510, 110, 140, 40);

        botonListar.setBackground(new java.awt.Color(255, 200, 0));
        botonListar.setText("Buscar");
        botonListar.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));
        botonListar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonListarActionPerformed(evt);
            }
        });
        add(botonListar);
        botonListar.setBounds(1090, 110, 130, 40);

        spinDesde.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        add(spinDesde);
        spinDesde.setBounds(90, 110, 80, 40);

        jLabel2.setBackground(new java.awt.Color(255, 200, 0));
        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel2.setText("<");
        jLabel2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        add(jLabel2);
        jLabel2.setBounds(170, 110, 30, 40);

        spinHasta.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        add(spinHasta);
        spinHasta.setBounds(200, 110, 80, 40);

        jLabel3.setBackground(new java.awt.Color(255, 200, 0));
        jLabel3.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jLabel3.setText("Precio: ");
        jLabel3.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        add(jLabel3);
        jLabel3.setBounds(20, 110, 70, 40);

        botonAlquilar.setBackground(new java.awt.Color(255, 100, 0));
        botonAlquilar.setText("Alquilar");
        botonAlquilar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonAlquilarActionPerformed(evt);
            }
        });
        add(botonAlquilar);
        botonAlquilar.setBounds(1100, 480, 130, 70);

        botonDetalles.setBackground(new java.awt.Color(255, 200, 0));
        botonDetalles.setText("Informacion");
        botonDetalles.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonDetallesActionPerformed(evt);
            }
        });
        add(botonDetalles);
        botonDetalles.setBounds(1100, 370, 130, 70);

        jcbZona.setBackground(new java.awt.Color(255, 200, 0));
        jcbZona.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Zona", "Centro", "Sur", "Norte", "Este", "Oeste", "Universitaria" }));
        jcbZona.setBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1));
        jcbZona.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcbZonaActionPerformed(evt);
            }
        });
        add(jcbZona);
        jcbZona.setBounds(320, 110, 120, 40);
    }// </editor-fold>//GEN-END:initComponents

    private void botonListarAction(int desdite,int hastita, int zonita, int tipito, int operacioncita, int estadito, int habitacioncita){
        //String tipazo,operacionazo,estadazo;
        //tipazo=tipoInmueble.get(tipito);
        //estadazo=estado.get(estadito);
        InmuebleController ic = new InmuebleController(this);
        ic.cargarInmuebles(desdite,hastita,tipito,operacioncita,estadito,habitacioncita);
    }
    
    private void botonListarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonListarActionPerformed
        botonListarAction(Integer.valueOf(String.valueOf(spinDesde.getValue())),
        Integer.valueOf(String.valueOf(spinHasta.getValue())),
        jcbZona.getSelectedIndex(),jcbTipoInmueble.getSelectedIndex(),
        jcbOperacion.getSelectedIndex(),jcbEstado.getSelectedIndex(),
        jcbHabitaciones.getSelectedIndex());
    }//GEN-LAST:event_botonListarActionPerformed
        
    private void botonAlquilarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonAlquilarActionPerformed
        if(tablaInmueble.getSelectedRow()!=-1){
            Inmueble aux = mapI.get(tablaInmueble.getValueAt(tablaInmueble.getSelectedRow(), 0));
            if(aux.getOperacion()!=1){
                if(aux.getEstado()==1 && (new InmuebleController(this)).estaAdministrado(aux.getDuenoID())){
                    jDialog1 = new javax.swing.JDialog();
                    jDialog1.setSize(1450, 800);
                    jDialog1.setTitle("Cargar Contrato"); 
                    jDialog1.setBounds(25, 50, 1150, 800);
                    jDialog1.setModal(true); 
                    int clienteID = aux.getDuenoID();
                    int inmuebleID = aux.getId();
                    jDialog1.add(new HacerContratoPanel(clienteID,inmuebleID, aux.getPrecio()));
                    jDialog1.setVisible(true);
                    return;
                }
                if(aux.getEstado() == 1){
                    jDialog1 = new javax.swing.JDialog();
                    jDialog1.setSize(1450, 800);
                    jDialog1.setTitle("Cargar Contrato"); 
                    jDialog1.setBounds(25, 50, 1125, 365);
                    jDialog1.setModal(true);
                    int clienteID = aux.getDuenoID();
                    int inmuebleID = aux.getId();
                    jDialog1.add(new HacerContratoSinADM(clienteID,inmuebleID));
                    jDialog1.setVisible(true);
                    return;
                }
            }
            else{JOptionPane.showMessageDialog(null, "El inmueble es unicamente para vender", "Error", JOptionPane.ERROR_MESSAGE);}
            
        }
        else{
            JOptionPane.showMessageDialog(null, "Debe seleccionar un inmueble", "Error", JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_botonAlquilarActionPerformed

    private void botonDetallesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonDetallesActionPerformed
        if(tablaInmueble.getSelectedRow()!=-1){
            jDialog2.setSize(1450, 800);
            jDialog2.setTitle("Informacion completa del Inmueble."); 
            jDialog2.setBounds(25, 50, 1250, 1200);
            jDialog2.setModal(true); 
            jDialog2.setVisible(true); 
        }
    }//GEN-LAST:event_botonDetallesActionPerformed

    private void jcbTipoInmuebleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcbTipoInmuebleActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jcbTipoInmuebleActionPerformed

    private void jcbOperacionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcbOperacionActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jcbOperacionActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        jDialog2.dispose();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jcbZonaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcbZonaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jcbZonaActionPerformed

    private DefaultTableModel tabla;
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton botonAlquilar;
    private javax.swing.JButton botonDetalles;
    private javax.swing.JButton botonListar;
    private javax.swing.JButton jButton1;
    private javax.swing.JDialog jDialog1;
    private javax.swing.JDialog jDialog2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JComboBox<String> jcbEstado;
    private javax.swing.JComboBox<String> jcbHabitaciones;
    private javax.swing.JComboBox<String> jcbOperacion;
    private javax.swing.JComboBox<String> jcbTipoInmueble;
    private javax.swing.JComboBox<String> jcbZona;
    private javax.swing.JSpinner spinDesde;
    private javax.swing.JSpinner spinHasta;
    private javax.swing.JTable tablaInmueble;
    // End of variables declaration//GEN-END:variables

    @Override
    public void llenarTabla(ArrayList<Inmueble> listaI) {
        int fila = 0;
        mapI = new HashMap<>();
        tabla = (DefaultTableModel)tablaInmueble.getModel();
        tabla.setRowCount(0);
        for(Inmueble inm : listaI){
            mapI.put(inm.getId(), inm);
            tabla.addRow(new Object [8]);
            tablaInmueble.setValueAt(inm.getId(), fila, 0);             //ID
            tablaInmueble.setValueAt(inm.getDireccion(), fila, 1);      //Direccion
            tablaInmueble.setValueAt(inm.getBarrio(), fila, 2);//Zona
            tablaInmueble.setValueAt(inm.getPrecio(), fila, 3);         //Precio
            tablaInmueble.setValueAt(tipoInmueble.get(inm.getTipo()), fila, 4);//Tipo de Inmueble
            tablaInmueble.setValueAt(operacion.get(inm.getOperacion()), fila, 5);//Operacion
            tablaInmueble.setValueAt(estado.get(inm.getEstado()), fila, 6);    //Estado
            tablaInmueble.setValueAt(inm.getHabitaciones(), fila, 7);    //Habitaciones
            fila++;
        }
    }

    @Override
    public void detalles(Inmueble inm) {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public void filtros(int estado, int tipo, int zona, int habitacion, int precio, ArrayList<Inmueble> listaI) {/*
        ArrayList<Inmueble> listaFiltrada = new ArrayList();
        for(Inmueble inm : listaI){
            if( (estado==inm.getEstado()) && (tipo==inm.getTipo()) && (habitacion==inm.getHabitaciones()) && (precio <= inm.getPrecio()))
                {listaFiltrada.add(inm);}
        }
        
        llenarTabla(listaFiltrada);*/
    }

    @Override
    public void borrarInmueble() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public void nuevoInmueble() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public void modificarInmueble() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }
}
